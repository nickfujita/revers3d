/*! othello 2016-02-13 */
function onMouseMove(a){a.preventDefault(),mouse.x=a.clientX/window.innerWidth*2-1,mouse.y=2*-(a.clientY/window.innerHeight)+1}function onMouseClick(a){a.preventDefault(),INTERSECTED?console.log("INTERSECTED:",INTERSECTED):console.log("should drag")}function onScrollDown(a){console.log("scrolldown")}function test(){console.log(scene.getObjectById(1))}function render(){raycaster.setFromCamera(mouse,camera);var a=raycaster.intersectObjects(scene.children);a.length>0?(document.body.style.cursor="pointer",INTERSECTED!=a[0].object&&(INTERSECTED&&INTERSECTED.material.emissive.setHex(INTERSECTED.currentHex),INTERSECTED=a[0].object,INTERSECTED.currentHex=INTERSECTED.material.emissive.getHex(),spotLight.target=INTERSECTED,INTERSECTED.geometry=pieceGeometry,console.log("INTERSECTED:",INTERSECTED))):INTERSECTED&&(document.body.style.cursor="crosshair",INTERSECTED.geometry=geometry,INTERSECTED=null),renderer.render(scene,camera),animationID=requestAnimationFrame(render)}var DeviceOrientationController=function(a,b){this.object=a,this.element=b||document,this.freeze=!0,this.enableManualDrag=!0,this.enableManualZoom=!0,this.useQuaternions=!0,this.deviceOrientation={},this.screenOrientation=window.orientation||0;var c,d,e,f,g,h=0,i=0,j=0,k=0,l=new THREE.Quaternion,m=1,n=1,o=new THREE.Vector2,p=new THREE.Vector2,q={AUTO:0,MANUAL_ROTATE:1,MANUAL_ZOOM:2},r=q.AUTO,s={CALIBRATE_COMPASS:"compassneedscalibration",SCREEN_ORIENTATION:"orientationchange",MANUAL_CONTROL:"userinteraction",ZOOM_CONTROL:"zoom",ROTATE_CONTROL:"rotate"},t=window.innerHeight,u=2e3*Math.tan(THREE.Math.degToRad((this.object.fov||75)/2)),v=new THREE.Quaternion,w=function(){var a;return function(b){a=arguments||{},a.type=b,a.target=this,this.dispatchEvent(a)}.bind(this)}.bind(this)();this.constrainObjectFOV=function(){f=u*(window.innerHeight/t),g=THREE.Math.radToDeg(2*Math.atan(f/2e3)),this.object.fov=g}.bind(this),this.onDeviceOrientationChange=function(a){this.deviceOrientation=a}.bind(this),this.onScreenOrientationChange=function(){this.screenOrientation=window.orientation||0,w(s.SCREEN_ORIENTATION)}.bind(this),this.onCompassNeedsCalibration=function(a){a.preventDefault(),w(s.CALIBRATE_COMPASS)}.bind(this),this.onDocumentMouseDown=function(a){this.enableManualDrag===!0&&(a.preventDefault(),r=q.MANUAL_ROTATE,this.freeze=!0,l.copy(this.object.quaternion),h=j=a.pageX,i=k=a.pageY,c=1200/window.innerWidth*.2,d=800/window.innerHeight*.2,this.element.addEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.addEventListener("mouseup",this.onDocumentMouseUp,!1),w(s.MANUAL_CONTROL+"start"),w(s.ROTATE_CONTROL+"start"))}.bind(this),this.onDocumentMouseMove=function(a){j=a.pageX,k=a.pageY}.bind(this),this.onDocumentMouseUp=function(a){this.element.removeEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.removeEventListener("mouseup",this.onDocumentMouseUp,!1),r=q.AUTO,this.freeze=!1,w(s.MANUAL_CONTROL+"end"),w(s.ROTATE_CONTROL+"end")}.bind(this),this.onDocumentTouchStart=function(a){switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(this.enableManualDrag!==!0)return;r=q.MANUAL_ROTATE,this.freeze=!0,l.copy(this.object.quaternion),h=j=a.touches[0].pageX,i=k=a.touches[0].pageY,c=1200/window.innerWidth*.1,d=800/window.innerHeight*.1,this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),w(s.MANUAL_CONTROL+"start"),w(s.ROTATE_CONTROL+"start");break;case 2:if(this.enableManualZoom!==!0)return;r=q.MANUAL_ZOOM,this.freeze=!0,e=this.object.fov,o.set(a.touches[0].pageX,a.touches[0].pageY),p.set(a.touches[1].pageX,a.touches[1].pageY),m=n=o.distanceTo(p),this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),w(s.MANUAL_CONTROL+"start"),w(s.ZOOM_CONTROL+"start")}}.bind(this),this.onDocumentTouchMove=function(a){switch(a.touches.length){case 1:j=a.touches[0].pageX,k=a.touches[0].pageY;break;case 2:o.set(a.touches[0].pageX,a.touches[0].pageY),p.set(a.touches[1].pageX,a.touches[1].pageY)}}.bind(this),this.onDocumentTouchEnd=function(a){this.element.removeEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.removeEventListener("touchend",this.onDocumentTouchEnd,!1),r===q.MANUAL_ROTATE?(r=q.AUTO,this.freeze=!1,w(s.MANUAL_CONTROL+"end"),w(s.ROTATE_CONTROL+"end")):r===q.MANUAL_ZOOM&&(this.constrainObjectFOV(),r=q.AUTO,this.freeze=!1,w(s.MANUAL_CONTROL+"end"),w(s.ZOOM_CONTROL+"end"))}.bind(this);var x=function(){var a=new THREE.Quaternion,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),e=0;return function(f,g,h,i){return b.set(g,f,-h,"YXZ"),a.setFromEuler(b),e=-i/2,c.set(0,Math.sin(e),0,Math.cos(e)),a.multiply(c),a.multiply(d),a}}(),y=function(){var a=new THREE.Matrix4,b=new THREE.Euler,c=new THREE.Euler,d=new THREE.Euler(-Math.PI/2,0,0,"YXZ"),e=new THREE.Matrix4,f=new THREE.Matrix4;return f.makeRotationFromEuler(d),function(d,g,h,i){return b.set(g,d,-h,"YXZ"),a.identity(),a.makeRotationFromEuler(b),c.set(0,-i,0,"YXZ"),e.identity(),e.makeRotationFromEuler(c),a.multiply(e),a.multiply(f),a}}();this.updateManualMove=function(){var a,b,f,g,s,t,u,w,x=new THREE.Euler(0,0,0,"YXZ"),y=new THREE.Quaternion,z=new THREE.Quaternion,A=1;return function(){z.copy(l),r===q.MANUAL_ROTATE?(a=(i-k)*d,b=(h-j)*c,f=THREE.Math.degToRad(a),g=THREE.Math.degToRad(b),y.set(0,Math.sin(g/2),0,Math.cos(g/2)),z.multiply(y),y.set(Math.sin(f/2),0,0,Math.cos(f/2)),z.multiply(y),s=x.setFromQuaternion(l,"YXZ").z,t=x.setFromQuaternion(z,"YXZ").z,u=x.setFromQuaternion(v||l,"YXZ").z,y.set(0,0,Math.sin((u-s)/2),Math.cos((u-s)/2)),l.multiply(y),y.set(0,0,Math.sin((u-t)/2),Math.cos((u-t)/2)),z.multiply(y),this.object.quaternion.copy(z)):r===q.MANUAL_ZOOM&&(n=o.distanceTo(p),w=m/n,A>=w&&(this.object.fov=e*w,this.object.updateProjectionMatrix()),v&&(s=x.setFromQuaternion(l,"YXZ").z,u=x.setFromQuaternion(v,"YXZ").z,y.set(0,0,Math.sin((u-s)/2),Math.cos((u-s)/2)),l.multiply(y),this.object.quaternion.copy(l)))}}(),this.updateDeviceMove=function(){var a,b,c,d,e;return function(){if(a=THREE.Math.degToRad(this.deviceOrientation.alpha||0),b=THREE.Math.degToRad(this.deviceOrientation.beta||0),c=THREE.Math.degToRad(this.deviceOrientation.gamma||0),d=THREE.Math.degToRad(this.screenOrientation||0),0!==a&&0!==b&&0!==c){if(this.useQuaternions?v=x(a,b,c,d):(e=y(a,b,c,d),v.setFromRotationMatrix(e)),this.freeze)return;this.object.quaternion.copy(v)}}}(),this.update=function(){this.updateDeviceMove(),r!==q.AUTO&&this.updateManualMove()},this.connect=function(){window.addEventListener("resize",this.constrainObjectFOV,!1),window.addEventListener("orientationchange",this.onScreenOrientationChange,!1),window.addEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.addEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),this.element.addEventListener("mousedown",this.onDocumentMouseDown,!1),this.element.addEventListener("touchstart",this.onDocumentTouchStart,!1),this.freeze=!1},this.disconnect=function(){this.freeze=!0,window.removeEventListener("resize",this.constrainObjectFOV,!1),window.removeEventListener("orientationchange",this.onScreenOrientationChange,!1),window.removeEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.removeEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),this.element.removeEventListener("mousedown",this.onDocumentMouseDown,!1),this.element.removeEventListener("touchstart",this.onDocumentTouchStart,!1)}};DeviceOrientationController.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.PointerLockControls=function(a){var b=this;a.rotation.set(0,0,0);var c=new THREE.Object3D;c.add(a);var d=new THREE.Object3D;d.position.y=10,d.add(c);var e=Math.PI/2,f=function(a){if(b.enabled!==!1){var f=a.movementX||a.mozMovementX||a.webkitMovementX||0,g=a.movementY||a.mozMovementY||a.webkitMovementY||0;d.rotation.y-=.002*f,c.rotation.x-=.002*g,c.rotation.x=Math.max(-e,Math.min(e,c.rotation.x))}};this.dispose=function(){document.removeEventListener("mousemove",f,!1)},document.addEventListener("mousemove",f,!1),this.enabled=!1,this.getObject=function(){return d},this.getDirection=function(){var a=new THREE.Vector3(0,0,-1),b=new THREE.Euler(0,0,0,"YXZ");return function(e){return b.set(c.rotation.x,d.rotation.y,0),e.copy(a).applyEuler(b),e}}()},THREE.VRControls=function(a,b){function c(a){var b=a.filter(function(a){return-1!==a.deviceName.toLowerCase().indexOf("oculus")});return b.length>=1?a.filter(function(a){return-1===a.deviceName.toLowerCase().indexOf("cardboard")}):a}function d(a){a=c(a);for(var d=0;d<a.length;d++)a[d]instanceof PositionSensorVRDevice&&f.push(a[d]);b&&b("HMD not available")}var e=this,f=[];navigator.getVRDevices&&navigator.getVRDevices().then(d),this.scale=1,this.update=function(){for(var b=0;b<f.length;b++){var c=f[b],d=c.getState();null!==d.orientation&&a.quaternion.copy(d.orientation),null!==d.position&&a.position.copy(d.position).multiplyScalar(e.scale)}},this.resetSensor=function(){for(var a=0;a<f.length;a++){var b=f[a];void 0!==b.resetSensor?b.resetSensor():void 0!==b.zeroSensor&&b.zeroSensor()}},this.zeroSensor=function(){console.warn("THREE.VRControls: .zeroSensor() is now .resetSensor()."),this.resetSensor()},this.dispose=function(){f=[]}};var scene=new THREE.Scene,light=new THREE.PointLight(16777215,4,100);light.position.set(0,10,90),scene.add(light);var spotLight=new THREE.SpotLight(16711782);spotLight.position.set(0,0,5),spotLight.castShadow=!0,scene.add(spotLight);var height=100,width=100,camera=new THREE.OrthographicCamera(width/-2,width/2,height/2,height/-2,1,1e3);camera.position.z=5;var renderer=new THREE.WebGLRenderer;renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement);for(var geometry=new THREE.BoxGeometry(.8,.8,.1),pieceGeometry=new THREE.IcosahedronGeometry(.4,0),material=new THREE.MeshLambertMaterial({color:10066329}),board=[],i=0;8>i;i++){board[i]=[];for(var j=0;8>j;j++)board[i][j]=new THREE.Mesh(geometry,material),board[i][j].position.x=i-3.25,board[i][j].position.y=j-3.25,scene.add(board[i][j])}window.onresize=function(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),isPaused=!0,setTimeout(function(){isPaused=!1},400)};var raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,INTERSECTED;window.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("mousedown",onMouseClick,!1),window.addEventListener("scrolldown",onScrollDown,!1),render();