/*! Revers3D 2016-04-11 */
function allowPointerLock(a){var b=document.getElementById("blocker"),c=document.getElementById("instructions");b.style.display="-webkit-box",b.style.display="-moz-box",b.style.display="box";var d="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;if(d){var e=document.body,f=function(d){document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e?(a.enabled=!0,b.style.display="none"):(a.enabled=!1,b.style.display="-webkit-box",b.style.display="-moz-box",b.style.display="box",c.style.display="")},g=function(a){c.style.display=""};document.addEventListener("pointerlockchange",f,!1),document.addEventListener("mozpointerlockchange",f,!1),document.addEventListener("webkitpointerlockchange",f,!1),document.addEventListener("pointerlockerror",g,!1),document.addEventListener("mozpointerlockerror",g,!1),document.addEventListener("webkitpointerlockerror",g,!1),c.addEventListener("click",function(a){if(a.stopPropagation(),c.style.display="none",e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var b=function(a){(document.fullscreenElement===e||document.mozFullscreenElement===e||document.mozFullScreenElement===e)&&(document.removeEventListener("fullscreenchange",b),document.removeEventListener("mozfullscreenchange",b),e.requestPointerLock())};document.addEventListener("fullscreenchange",b,!1),document.addEventListener("mozfullscreenchange",b,!1),e.requestFullscreen=e.requestFullscreen||e.mozRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen,e.requestFullscreen()}else e.requestPointerLock()},!1)}else c.innerHTML="Your browser doesn't seem to support Pointer Lock API"}function Tile(a){this.constructor=Tile,this.ownedBy=null,this.isCorner=!!a}function GameState(){var a=getters.getMasterData(),b=getters.getA(),c=getters.getB(),d=getters.getC(),e=getters.getD();this.data=deepExtend({},a),this.a1=this.data.faces[-b][c][b],this.a2=this.data.faces[b][c][b],this.a3=this.data.faces[-b][c][-b],this.a4=this.data.faces[b][c][-b],this.a5=this.data.edges[-b][d][-d],this.a6=this.data.edges[b][d][-d],this.a7=this.data.corners[e][e][-e],this.a8=this.data.edges[d][d][-b],this.b1=this.data.edges[d][d][b],this.b2=this.data.corners[e][e][e],this.b3=this.data.edges[b][d][d],this.b4=this.data.edges[-b][d][d],this.b5=this.data.corners[-e][e][e],this.b6=this.data.edges[-d][d][b],this.b7=this.data.edges[-d][d][-b],this.b8=this.data.corners[-e][e][-e],this.c1=this.data.faces[-b][b][-c],this.c2=this.data.faces[b][b][-c],this.c3=this.data.edges[d][b][-d],this.c4=this.data.faces[c][-b][-b],this.c5=this.data.faces[c][b][b],this.c6=this.data.edges[d][b][d],this.c7=this.data.faces[b][b][c],this.c8=this.data.faces[-b][b][c],this.d1=this.data.edges[-d][b][d],this.d2=this.data.faces[-c][b][b],this.d3=this.data.faces[-c][b][-b],this.d4=this.data.edges[-d][b][-d],this.d5=this.data.faces[-b][-b][-c],this.d6=this.data.faces[b][-b][-c],this.d7=this.data.edges[d][-b][-d],this.d8=this.data.faces[c][-b][b],this.e1=this.data.faces[c][b][-b],this.e2=this.data.edges[d][-b][d],this.e3=this.data.faces[b][-b][c],this.e4=this.data.faces[-b][-b][c],this.e5=this.data.edges[-d][-b][d],this.e6=this.data.faces[-c][-b][b],this.e7=this.data.faces[-c][-b][-b],this.e8=this.data.edges[-d][-b][-d],this.f1=this.data.edges[-b][-d][-d],this.f2=this.data.edges[b][-d][-d],this.f3=this.data.corners[e][-e][-e],this.f4=this.data.edges[d][-d][-b],this.f5=this.data.edges[d][-d][b],this.f6=this.data.corners[e][-e][e],this.f7=this.data.edges[b][-d][d],this.f8=this.data.edges[-b][-d][d],this.g1=this.data.corners[-e][-e][e],this.g2=this.data.edges[-d][-d][b],this.g3=this.data.edges[-d][-d][-b],this.g4=this.data.corners[-e][-e][-e],this.g5=this.data.faces[-b][-c][-b],this.g6=this.data.faces[b][-c][-b],this.g7=this.data.faces[-b][-c][b],this.g8=this.data.faces[b][-c][b];for(var f in this)2===f.length&&(this[f].coord=f);this.configure()}function allCombos(a,b){var c={};if(a.length)for(var d=0;d<a.length;d++)c[a[d]]=deepExtend({},allCombos(a.slice(0,d).concat(a.slice(d+1)),b)),c[-a[d]]=deepExtend({},allCombos(a.slice(0,d).concat(a.slice(d+1)),b));else c=b;return c}function deepExtend(a){for(var b=Array.prototype.slice.call(arguments,1),c=0;c<b.length;c++)for(var d in b[c])a.hasOwnProperty(d)&&"object"==typeof b[c][d]?deepExtend(a[d],b[c][d]):a[d]=b[c][d];return a}function Board(a,b){THREE.Object3D.call(this),this.gs=a,this.players=b,this.material={color:10066329};var c=new THREE.Vector3(0,0,0),d=this.gs.data.TILE_WIDTH,e=this.gs.data.PADDING,f=this.gs.data.DEPTH,g=d+e,h=g*Math.sin(Math.PI/4),i=.5*g,j=g+h,k=(g+1/3*h+.5*this.DEPTH,{amount:f,bevelEnabled:!1}),l=new THREE.Shape,m=d,n=Math.sqrt(3)/2*m;l.moveTo(-0.5*m,-1/3*n),l.lineTo(0,2/3*n),l.lineTo(.5*m,-1/3*n),l.lineTo(-0.5*m,-1/3*n);var o,p=new THREE.ExtrudeGeometry(l,k),q=new THREE.BoxGeometry(d,d,f),r=q.clone().rotateX(-Math.PI/2),s=q.clone().rotateY(-Math.PI/2),t=r.clone().rotateX(Math.PI/4),u=r.clone().rotateX(-Math.PI/4),v=q.clone().rotateY(Math.PI/4),w=q.clone().rotateY(-Math.PI/4),x=s.clone().rotateZ(Math.PI/4),y=s.clone().rotateZ(-Math.PI/4),z=this.gs.data.faces;for(var A in z)for(var B in z[A])for(var C in z[A][B])o=Math.abs(A)==j?s:Math.abs(B)==j?r:q,z[A][B][C].mesh=new THREE.Mesh(o,new THREE.MeshLambertMaterial(this.material)),z[A][B][C].mesh.position.set(A,B,C),z[A][B][C].mesh.userData={coord:z[A][B][C].coord},this.add(z[A][B][C].mesh);var D=this.gs.data.edges;for(var A in D)for(var B in D[A])for(var C in D[A][B])o=Math.abs(A)==i?0>B*C?u:t:Math.abs(B)==i?0>A*C?w:v:0>A*B?y:x,D[A][B][C].mesh=new THREE.Mesh(o,new THREE.MeshLambertMaterial(this.material)),D[A][B][C].mesh.position.set(A,B,C),D[A][B][C].mesh.userData={coord:D[A][B][C].coord},this.add(D[A][B][C].mesh);var E=this.gs.data.corners;for(var A in E)for(var B in E[A])for(var C in E[A][B])E[A][B][C].mesh=new THREE.Mesh(p,new THREE.MeshLambertMaterial(this.material)),E[A][B][C].mesh.position.set(A,B,C),E[A][B][C].mesh.userData={coord:E[A][B][C].coord},E[A][B][C].mesh.lookAt(c),Math.sign(B)<0&&E[A][B][C].mesh.rotateZ(Math.PI/3),this.add(E[A][B][C].mesh);this.init()}if(THREE.StereoEffect=function(a){var b=new THREE.StereoCamera;b.aspect=.5,this.setSize=function(b,c){a.setSize(b,c)},this.render=function(c,d){c.updateMatrixWorld(),null===d.parent&&d.updateMatrixWorld(),b.update(d);var e=a.getSize();a.setScissorTest(!0),a.clear(),a.setScissor(0,0,e.width/2,e.height),a.setViewport(0,0,e.width/2,e.height),a.render(c,b.cameraL),a.setScissor(e.width/2,0,e.width/2,e.height),a.setViewport(e.width/2,0,e.width/2,e.height),a.render(c,b.cameraR),a.setScissorTest(!1)}},THREE.DeviceOrientationControls=function(a){var b=this;this.object=a,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0;var c=function(a){b.deviceOrientation=a},d=function(){b.screenOrientation=window.orientation||0},e=function(){var a=new THREE.Vector3(0,0,1),b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(e,f,g,h,i){b.set(g,f,-h,"YXZ"),e.setFromEuler(b),e.multiply(d),e.multiply(c.setFromAxisAngle(a,-i))}}();this.connect=function(){d(),window.addEventListener("orientationchange",d,!1),window.addEventListener("deviceorientation",c,!1),b.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",d,!1),window.removeEventListener("deviceorientation",c,!1),b.enabled=!1},this.update=function(){if(b.enabled!==!1){var a=b.deviceOrientation.alpha?THREE.Math.degToRad(b.deviceOrientation.alpha):0,c=b.deviceOrientation.beta?THREE.Math.degToRad(b.deviceOrientation.beta):0,d=b.deviceOrientation.gamma?THREE.Math.degToRad(b.deviceOrientation.gamma):0,f=b.screenOrientation?THREE.Math.degToRad(b.screenOrientation):0;e(b.object.quaternion,a,c,d,f)}},this.dispose=function(){this.disconnect()},this.connect()},THREE.PointerLockControls=function(a){var b=this;a.rotation.set(0,0,0);var c=new THREE.Object3D;c.add(a);var d=new THREE.Object3D;d.add(c);var e=Math.PI/2,f=function(a){if(b.enabled!==!1){var f=a.movementX||a.mozMovementX||a.webkitMovementX||0,g=a.movementY||a.mozMovementY||a.webkitMovementY||0;d.rotation.y-=.002*f,c.rotation.x-=.002*g,c.rotation.x=Math.max(-e,Math.min(e,c.rotation.x))}};this.dispose=function(){document.removeEventListener("mousemove",f,!1)},document.addEventListener("mousemove",f,!1),this.enabled=!1,this.getObject=function(){return d},this.getDirection=function(){var a=new THREE.Vector3(0,0,-1),b=new THREE.Euler(0,0,0,"YXZ");return function(e){return b.set(c.rotation.x,d.rotation.y,0),e.copy(a).applyEuler(b),e}}()},THREE.TapTouchControls=function(a){a.rotation.set(0,0,0),this.pitchObject=new THREE.Object3D,this.pitchObject.add(a),this.yawObject=new THREE.Object3D,this.yawObject.add(this.pitchObject),this.getObject=function(){return this.yawObject},this.getDirection=function(){var a=new THREE.Vector3(0,0,-1),b=new THREE.Euler(0,0,0,"YXZ");return function(c){return b.set(this.pitchObject.rotation.x,this.yawObject.rotation.y,0),c.copy(a).applyEuler(b),c}}()},THREE.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry),a.merge(b,d,c)},randomPointInTriangle:function(){var a=new THREE.Vector3;return function(b,c,d){var e=new THREE.Vector3,f=Math.random(),g=Math.random();f+g>1&&(f=1-f,g=1-g);var h=1-f-g;return e.copy(b),e.multiplyScalar(f),a.copy(c),a.multiplyScalar(g),e.add(a),a.copy(d),a.multiplyScalar(h),e.add(a),e}}(),randomPointInFace:function(a,b){var c,d,e;return c=b.vertices[a.a],d=b.vertices[a.b],e=b.vertices[a.c],THREE.GeometryUtils.randomPointInTriangle(c,d,e)},randomPointsInGeometry:function(a,b){function c(a){function b(c,d){if(c>d)return c;var e=c+Math.floor((d-c)/2);return m[e]>a?b(c,e-1):m[e]<a?b(e+1,d):e}var c=b(0,m.length-1);return c}var d,e,f,g,h,i=a.faces,j=a.vertices,k=i.length,l=0,m=[];for(e=0;k>e;e++)d=i[e],f=j[d.a],g=j[d.b],h=j[d.c],d._area=THREE.GeometryUtils.triangleArea(f,g,h),l+=d._area,m[e]=l;var n,o,p=[],q={};for(e=0;b>e;e++)n=Math.random()*l,o=c(n),p[e]=THREE.GeometryUtils.randomPointInFace(i[o],a),q[o]?q[o]+=1:q[o]=1;return p},randomPointsInBufferGeometry:function(a,b){function c(a){function b(c,d){if(c>d)return c;var e=c+Math.floor((d-c)/2);return j[e]>a?b(c,e-1):j[e]<a?b(e+1,d):e}var c=b(0,j.length-1);return c}var d,e,f,g,h=a.attributes.position.array,i=0,j=[];e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3;var k=h.length/9;for(d=0;k>d;d++)e.set(h[9*d+0],h[9*d+1],h[9*d+2]),f.set(h[9*d+3],h[9*d+4],h[9*d+5]),g.set(h[9*d+6],h[9*d+7],h[9*d+8]),area=THREE.GeometryUtils.triangleArea(e,f,g),i+=area,j.push(i);var l,m,n=[];for(d=0;b>d;d++)l=Math.random()*i,m=c(l),e.set(h[9*m+0],h[9*m+1],h[9*m+2]),f.set(h[9*m+3],h[9*m+4],h[9*m+5]),g.set(h[9*m+6],h[9*m+7],h[9*m+8]),n[d]=THREE.GeometryUtils.randomPointInTriangle(e,f,g);return n},triangleArea:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){return a.subVectors(d,c),b.subVectors(e,c),a.cross(b),.5*a.length()}}(),center:function(a){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),a.center()}},Tile.prototype.traverse=function(a,b){var c=(this.edges.indexOf(a)+.5*this.edges.length)%this.edges.length;return b(this),this.edges[c]},Tile.prototype.addEdge=function(){var a=this.isCorner?6:8;this.edges=Array.prototype.slice.call(arguments,0,a)},Tile.prototype.setOwner=function(a,b){this.ownedBy=a},!window){var Tile=require("./Tile"),utils=require("./utils");module.exports=GameState}var getters=function(){function a(){return f}function b(){return i}function c(){return j}function d(){return k}function e(){return l}var f={};f.TILE_WIDTH=19,f.PADDING=3,f.DEPTH=1;var g=f.TILE_WIDTH+f.PADDING,h=g*Math.sin(Math.PI/4),i=.5*g,j=g+h,k=g+.5*h,l=g+1/3*h+.5*f.DEPTH;return f.faces=allCombos([i,i,j],new Tile),f.edges=allCombos([k,k,i],new Tile),f.corners=allCombos([l,l,l],new Tile(!0)),{getMasterData:a,getA:b,getB:c,getC:d,getD:e}}();GameState.prototype.init=function(){this.c1.setOwner(0),this.d6.setOwner(0),this.c2.setOwner(1),this.d5.setOwner(1)},GameState.prototype.capture=function(a,b){var c,d=this[a],e=d.edges,f=[d];return focus.currentHex=PLAYER[b].color,e.forEach(function(a,e,g){var h=d,i=a;for(c=[];i.ownedBy===1-b;)i=i.traverse(h,function(a){c.push(a),h=a});c.length&&i.ownedBy===b?(f=f.concat(c),c=[]):c=[]}),f.forEach(function(a){a.setOwner(b)}),f.length},GameState.prototype.reset=function(){this.data.faces=deepExtend({},_MASTER_DATA.faces),this.data.edges=deepExtend({},_MASTER_DATA.edges),this.data.corners=deepExtend({},_MASTER_DATA.corners),this.init()},GameState.prototype.configure=function(){this.a1.addEdge(this.b5,this.b4,this.b3,this.a2,this.a4,this.a3,this.b7,this.b6),this.a2.addEdge(this.b4,this.b3,this.b2,this.b1,this.a8,this.a4,this.a3,this.a1),this.a3.addEdge(this.b6,this.a1,this.a2,this.a4,this.a6,this.a5,this.b8,this.b7),this.a4.addEdge(this.a1,this.a2,this.b1,this.a8,this.a7,this.a6,this.a5,this.a3),this.a5.addEdge(this.b7,this.a3,this.a4,this.a6,this.c2,this.c1,this.d4,this.b8),this.a6.addEdge(this.a3,this.a4,this.a8,this.a7,this.c3,this.c2,this.c1,this.a5),this.a7.addEdge(this.a6,this.a4,this.a8,this.e1,this.c3,this.c2),this.a8.addEdge(this.a6,this.a4,this.a2,this.b1,this.c5,this.e1,this.c3,this.a7),this.b1.addEdge(this.a4,this.a2,this.b3,this.b2,this.c6,this.c5,this.e1,this.a8),this.b2.addEdge(this.b1,this.a2,this.b3,this.c7,this.c6,this.c5),this.b3.addEdge(this.b1,this.a2,this.a1,this.b4,this.c8,this.c7,this.c6,this.b2),this.b4.addEdge(this.a2,this.a1,this.b6,this.b5,this.d1,this.c8,this.c7,this.b3),this.b5.addEdge(this.b4,this.a1,this.b6,this.d2,this.d1,this.c8),this.b6.addEdge(this.b4,this.a1,this.a3,this.b7,this.d3,this.d2,this.d1,this.b5),this.b7.addEdge(this.a1,this.a3,this.a5,this.b8,this.d4,this.d3,this.d2,this.b6),this.b8.addEdge(this.b7,this.a3,this.a5,this.c1,this.d4,this.d3),this.c1.addEdge(this.b8,this.a5,this.a6,this.c2,this.d6,this.d5,this.e8,this.d4),this.c2.addEdge(this.a5,this.a6,this.a7,this.c3,this.d7,this.d6,this.d5,this.c1),this.c3.addEdge(this.a6,this.a7,this.a8,this.e1,this.c4,this.d7,this.d6,this.c2),this.c4.addEdge(this.c3,this.e1,this.c5,this.d8,this.f5,this.f4,this.f3,this.d7),this.c5.addEdge(this.a8,this.b1,this.b2,this.c6,this.e2,this.e1,this.d8,this.c4),this.c6.addEdge(this.b1,this.b2,this.b3,this.c7,this.e3,this.e2,this.d8,this.c5),this.c7.addEdge(this.b2,this.b3,this.b4,this.c8,this.e4,this.e3,this.e2,this.c6),this.c8.addEdge(this.b3,this.b4,this.b5,this.d1,this.e5,this.e4,this.e3,this.c7),this.d1.addEdge(this.b4,this.b5,this.b6,this.d2,this.e6,this.e5,this.e4,this.c8),this.d2.addEdge(this.b5,this.b6,this.b7,this.d3,this.e7,this.e6,this.e5,this.d1),this.d3.addEdge(this.b6,this.b7,this.b8,this.d4,this.e8,this.e7,this.e6,this.d2),this.d4.addEdge(this.b7,this.b8,this.a5,this.c1,this.d5,this.e8,this.e7,this.d3),this.d5.addEdge(this.d4,this.c1,this.c2,this.d6,this.f2,this.f1,this.g4,this.e8),this.d6.addEdge(this.c1,this.c2,this.c3,this.d7,this.f3,this.f2,this.f1,this.d5),this.d7.addEdge(this.c2,this.c3,this.e1,this.c4,this.f4,this.f3,this.f2,this.d6),this.d8.addEdge(this.e1,this.c5,this.c6,this.e2,this.f6,this.f5,this.f4,this.c4),this.e1.addEdge(this.a7,this.a8,this.b1,this.c5,this.d8,this.c4,this.d7,this.c3),this.e2.addEdge(this.c5,this.c6,this.c7,this.e3,this.f7,this.f6,this.f5,this.d8),this.e3.addEdge(this.c6,this.c7,this.c8,this.e4,this.f8,this.f7,this.f6,this.e2),this.e4.addEdge(this.c7,this.c8,this.d1,this.e5,this.g1,this.f8,this.f7,this.e3),this.e5.addEdge(this.c8,this.d1,this.d2,this.e6,this.g2,this.g1,this.f8,this.e4),this.e6.addEdge(this.d1,this.d2,this.d3,this.e7,this.g3,this.g2,this.g1,this.e5),this.e7.addEdge(this.d2,this.d3,this.d4,this.e8,this.g4,this.g3,this.g2,this.e6),this.e8.addEdge(this.d3,this.d4,this.c1,this.d5,this.f1,this.g4,this.g3,this.e7),this.f1.addEdge(this.e8,this.d5,this.d6,this.f2,this.g6,this.g5,this.g3,this.g4),this.f2.addEdge(this.d5,this.d6,this.d7,this.f3,this.f4,this.g6,this.g5,this.f1),this.f3.addEdge(this.d6,this.d7,this.c4,this.f4,this.g6,this.f2),this.f4.addEdge(this.d7,this.c4,this.d8,this.f5,this.g8,this.g6,this.f2,this.f3),this.f5.addEdge(this.c4,this.d8,this.e2,this.f6,this.f7,this.g8,this.g6,this.f4),this.f6.addEdge(this.d8,this.e2,this.e3,this.f7,this.g8,this.f5),this.f7.addEdge(this.e2,this.e3,this.e4,this.f8,this.g7,this.g8,this.f5,this.f6),this.f8.addEdge(this.e3,this.e4,this.e5,this.g1,this.g2,this.g7,this.g8,this.f7),this.g1.addEdge(this.e4,this.e5,this.e6,this.g2,this.g7,this.f8),this.g2.addEdge(this.e5,this.e6,this.e7,this.g3,this.g5,this.g7,this.f8,this.g1),this.g3.addEdge(this.e6,this.e7,this.e8,this.g4,this.f1,this.g5,this.g7,this.g2),this.g4.addEdge(this.e7,this.e8,this.d5,this.f1,this.g5,this.g3),this.g5.addEdge(this.g4,this.f1,this.f2,this.g6,this.g8,this.g7,this.g2,this.g3),this.g6.addEdge(this.f1,this.f2,this.f3,this.f4,this.f5,this.g8,this.g7,this.g5),this.g7.addEdge(this.g3,this.g5,this.g6,this.g8,this.f7,this.f8,this.g1,this.g2),this.g8.addEdge(this.g5,this.g6,this.f4,this.f5,this.f6,this.f7,this.f8,this.g7)},Board.prototype=Object.create(THREE.Object3D.prototype),Board.constructor=Board,Board.prototype.light=function(a,b){b=b||8388352;var c=this.gs[a];c.previousColor=c.mesh.material.emissive.getHex(),c.mesh.material.emissive.setHex(b)},Board.prototype.unlight=function(a,b){b=b||8388352;var c=this.gs[a];c.mesh.material.emissive.setHex(c.previousColor)},Board.prototype.draw=function(a){a.add(this)},Board.prototype.erase=function(a){a.remove(this)},Board.prototype.init=function(){this.light("c1",this.players[0].color),this.light("d6",this.players[0].color),this.light("c2",this.players[1].color),this.light("d5",this.players[1].color),this.gs.init()},Board.prototype.capture=function(a,b,c){function d(a,c){a.setOwner(b),a.mesh.currentHex=j,setTimeout(function(){k.light(a.coord,j)},50*c)}function e(a){a.setOwner(b),a.mesh.currentHex=j,k.light(a.coord,j)}var f,g=this.gs[a],h=g.edges,i=[g],j=this.players[b].color;h.forEach(function(a,c,d){var e=g,h=a;for(f=[];h.ownedBy===1-b;)h=h.traverse(e,function(a){f.push(a),e=a});f.length&&h.ownedBy===b?(i=i.concat(f),f=[]):f=[]});var k=this,l=c?e:d;return i.forEach(l),i.length},function(){function a(b){if(!o){var c=(b-U)/1e3;L.x-=10*L.x*c,L.y-=10*L.y*c,L.z-=10*L.z*c,M&&(L.z-=400*c),N&&(L.z+=400*c),O&&(L.x-=400*c),P&&(L.x+=400*c),Q&&(L.y+=400*c),R&&(L.y-=400*c),B.getObject().translateX(L.x*c),B.getObject().translateY(L.y*c),B.getObject().translateZ(L.z*c),U=b}A(),m(),z(),window.requestAnimationFrame(a)}function b(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),y.setSize(window.innerWidth,window.innerHeight),C.setSize(window.innerWidth,window.innerHeight)}function c(a){if(a.stopPropagation(),J){var b=J.userData.coord;if(null===I[b].ownedBy)if(window.isMultiplayer)H.emit("send move",b);else{var c=board.capture(b,p);if(q[p]+=c,p=~~!p,q[p]-=c-1,s.innerText=2===q[0].toString().length?q[0]:"0"+q[0],t.innerText=2===q[1].toString().length?q[1]:"0"+q[1],r.innerText="Player "+(p+1)+"'s turn",q[0]+q[1]===56){var d="Game over. ";d+=q[0]===q[1]?"It's a Tie! ":"Player "+(q[0]>q[1]?1:2)+" wins!",r.innerText=d}}else console.log(J.userData.coord,"owned by player",I[b].ownedBy)}}function d(a){1===a.touches.length&&(E=a.touches[0].pageX,F=a.touches[0].pageY,G=Date.now())}function e(a){if(1===a.touches.length){a.preventDefault();var b=a.touches[0].pageX,c=a.touches[0].pageY,d=b-E,e=c-F,f=Math.PI/2;B.yawObject.rotation.y+=.005*d,E+=d,B.pitchObject.rotation.x+=.005*e,B.pitchObject.rotation.x=Math.max(-f,Math.min(f,B.pitchObject.rotation.x)),F+=e}}function f(a){a.preventDefault();var b=Date.now()-G<150;b?(c(a),console.log("click!")):console.log("hold!")}function g(a){switch(a.keyCode){case 38:case 87:M=!0;break;case 37:case 65:O=!0;break;case 40:case 83:N=!0;break;case 39:case 68:P=!0;break;case 32:Q=!0;break;case 16:R=!0}}function h(a){switch(a.keyCode){case 38:case 87:M=!1;break;case 37:case 65:O=!1;break;case 40:case 83:N=!1;break;case 39:case 68:P=!1;break;case 32:Q=!1;break;case 16:R=!1}}function i(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}}function j(a){a.stopPropagation();var b=window.document,c=b.documentElement,d=c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullScreen||c.msRequestFullscreen,e=b.exitFullscreen||b.mozCancelFullScreen||b.webkitExitFullscreen||b.msExitFullscreen;b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement||b.msFullscreenElement?e.call(b):d.call(c)}function k(){document.removeEventListener("touchmove",e,!1),v.remove(B.getObject()),B=new THREE.DeviceOrientationControls(w),z=C.render.bind(C,v,w),A=B.update.bind(B)}function l(){B=new THREE.TapTouchControls(w),document.addEventListener("touchmove",e,!1),y.setSize(window.innerWidth,window.innerHeight),z=y.render.bind(y,v,w),A=w.updateProjectionMatrix.bind(w),v.add(B.getObject())}function m(){window.isMultiplayer&&window.PLAYER_NUM!==p||(S.setFromCamera(T,w),K=S.intersectObjects(board.children),K.length>0?J!=K[0].object&&(J&&J.material.emissive.setHex(J.currentHex),J=K[0].object,J.currentHex=J.material.emissive.getHex(),null===I[J.userData.coord].ownedBy&&J.material.emissive.setHex(u[p].color)):J&&(J.material.emissive.setHex(J.currentHex),J=null))}function n(){H=io(window.location.pathname,{some:"data"}),H.on("connection",function(a){if(a.hasOwnProperty("playerNum"))window.PLAYER_NUM=a.playerNum,r.innerText="You are player "+(a.playerNum+1)+"!";else{r.innerText="You are spectating",s.innerText=q[0].length=q[0],t.innerText=q[1].length=q[1],p=a.turn;var b=0;a.moves.forEach(function(a){board.capture(a,b,!0),b=~~!b})}}),H.on("user connected",function(a){}),H.on("receive move",function(a){board.capture(a.move,a.turn),p=~~!a.turn,q=a.scores,s.innerText=2===q[0].toString().length?q[0]:"0"+q[0],t.innerText=2===q[1].toString().length?q[1]:"0"+q[1],r.innerText=window.hasOwnProperty("PLAYER_NUM")&&window.PLAYER_NUM===p?"Your turn":"Player "+(p+1)+"'s turn"}),H.on("game over",function(a){console.log("game over"),r.innerText=a.message+" Final score: "+a.scores[0]+" : "+a.scores[1]}),H.on("player leave",function(a){var b=a.scores.reduce(function(a,b){return a+b},-4);b?r.innerText="Player "+(a.playerNum+1)+"disconnected. Final score: "+a.scores[0]+" : "+a.scores[1]:(window.PLAYER_NUM=0,r.innerText="Player "+(a.playerNum+1)+" disconnected. You are now player 1.")})}var o=i(),p=0,q=[2,2],r=document.getElementById("notification"),s=document.getElementById("score1"),t=document.getElementById("score2"),u=[{color:16711680},{color:1968639}],v=new THREE.Scene;v.fog=new THREE.Fog(16777215,0,750);var w=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),x=new THREE.HemisphereLight(15658751,7829384,.75);x.position.set(.5,1,.75),v.add(x);var y=new THREE.WebGLRenderer;y.setClearColor(16777215),y.setPixelRatio(window.devicePixelRatio),y.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(y.domElement);var z,A,B,C=new THREE.StereoEffect(y);window.addEventListener("resize",b,!1),document.addEventListener("click",c,!1);var D=document.getElementById("fs-icon");if(D.addEventListener("click",j,!1),D.addEventListener("touchstart",j,!1),o){B=new THREE.DeviceOrientationControls(w);var E,F,G;document.addEventListener("touchstart",d,!1),document.addEventListener("touchend",f,!1),z=C.render.bind(C,v,w),A=B.update.bind(B)}else B=new THREE.PointerLockControls(w),document.addEventListener("keydown",g,!1),document.addEventListener("keyup",h,!1),allowPointerLock(B),z=y.render.bind(y,v,w),A=w.updateProjectionMatrix.bind(w),v.add(B.getObject());window.board=new Board(new GameState,u);var H,I=board.gs;board.draw(v),window.hasOwnProperty("isMultiplayer")&&n();var J,K,L=new THREE.Vector3,M=!1,N=!1,O=!1,P=!1,Q=!1,R=!1,S=new THREE.Raycaster,T=new THREE.Vector2;window.requestAnimationFrame(a);var U=performance.now();window.enterVR=k,window.exitVR=l}();